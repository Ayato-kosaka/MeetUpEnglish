<h2>gmap</h2>

<!-- 地名入力用のinputを追加 -->
<input id="address" type="textbox" value="Sydney, NSW">

<!-- buttonをクリックしたらcodeAddressを実行　-->
<input type="button" value="Encode" onclick="codeAddress()">
<div id='map'>
</div>

<style>
#map{
  height: 400px;
}
</style>

<script>
/*
mapを関数の外で定義(codeAddressでも使うため)
geocoderを用意
*/

let map
let geocoder

function initMap(){
  // geocoderを初期化
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 35.566733, lng: 139.40289},
      zoom: 14,
      language: 'en'
    });
    google.maps.event.addListener(map, 'click', function(e){// if map is clicked
      alert(!!e.placeId);
  });
  service = new google.maps.places.PlacesService(map);
}


//オートコンプリートのオプション
function initAutocomplete() {
    //対応させるテキストボックス
    var input = document.getElementById('address');
    //プレイスを検索する領域 => japan
    var LatLngFrom = new google.maps.LatLng(35.692195,139.7576653);
    var LatLngTo   = new google.maps.LatLng(35.696157,139.7525771);
    var bounds = new google.maps.LatLngBounds(LatLngFrom, LatLngTo);
    //オートコンプリートのオプション
    var options = {
        types: ['establishment'],                      // 検索タイプ
        bounds: bounds,                            // 範囲優先検索
        componentRestrictions: {country: 'jp'}     // 日本国内の住所のみ
    };
    autocomplete = new google.maps.places.Autocomplete( input, options);
    autocomplete.addListener('place_changed', function() {
      codeAddress(this.gm_accessors_.place.Yc.m)
    });
}
window.onload = initAutocomplete;


//geocoding
function codeAddress(arg){

  // 入力を取得
  let inputAddress = arg
  // console.log("addess is "+ arg)
  // console.log("name1 is "+ arg.split(',').pop())//.popは元の配列を壊す->array[array.length - 1]
  // console.log("name2 is "+ arg.split(',')[0])
  if (!inputAddress){
    inputAddress = document.getElementById('address').value;
  }

  // geocodingしたあとmapを移動
  geocoder.geocode( { 'address': inputAddress}, function(results, status) {
    if (status == 'OK') {
      // map.setCenterで地図が移動
      map.setCenter(results[0].geometry.location);
      map.setZoom(17);
      console.log("lat and lng is "+results[0].geometry.location.lat()+","+results[0].geometry.location.lng())
      console.log(results[0])
      // google.maps.MarkerでGoogleMap上の指定位置にマーカが立つ
      var marker = new google.maps.Marker({
          map: map,
          place: {
            placeId: results[0].place_id,
            location: results[0].geometry.location
          }
      });
      service.getDetails({placeId: results[0].place_id, fields: ['name', 'website']}, function (place, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
            console.log(place);
          }
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}




</script>



















<script src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyAI1LzbpC5PZqv-0m6ciWAlSKMMJplLRYo&sensor=false&callback=initMap&libraries=places&&region=JP" async defer></script>
